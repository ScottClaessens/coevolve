<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fit Bayesian Generalized Dynamic Phylogenetic Models using Stan • coevolve</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fit Bayesian Generalized Dynamic Phylogenetic Models using Stan">
<meta name="description" content="Fit Bayesian generalized dynamic phylogenetic models using Stan. The package allows an abritrary number of variables with different response distributions to coevolve on a phylogenetic tree via an Ornstein-Uhlenbeck evolutionary process, allowing users to assess directionality between coevolving variables.">
<meta property="og:description" content="Fit Bayesian generalized dynamic phylogenetic models using Stan. The package allows an abritrary number of variables with different response distributions to coevolve on a phylogenetic tree via an Ornstein-Uhlenbeck evolutionary process, allowing users to assess directionality between coevolving variables.">
<meta property="og:image" content="https://scottclaessens.github.io/coevolve/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">coevolve</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9021</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/coevolve.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ScottClaessens/coevolve/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img src="reference/figures/logo.png" height="139" alt="coevolve Logo"><a href="https://mc-stan.org/" class="external-link"><img src="https://raw.githubusercontent.com/stan-dev/logos/master/logo_tm.png" align="right" height="139" alt="Stan Logo"></a></p>
<div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="coevolve">coevolve<a class="anchor" aria-label="anchor" href="#coevolve"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <strong>coevolve</strong> package allows the user to fit Bayesian generalized dynamic phylogenetic models in Stan. These models can be used to estimate how variables have coevolved over evolutionary time and to assess causal directionality (X → Y vs. Y → X) and contingencies (X, then Y) in evolution.</p>
<p>While existing methods only allow pairs of binary traits to coevolve (e.g., <a href="https://www.evolution.reading.ac.uk/BayesTraitsV4.1.2/BayesTraitsV4.1.2.html" class="external-link">BayesTraits</a>), the <strong>coevolve</strong> package allows users to include multiple traits of different data types, including binary, ordinal, count, and continuous traits.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To use the <strong>coevolve</strong> package, you must first install the <code>cmdstanr</code> package (see full installation instructions here: <a href="https://mc-stan.org/cmdstanr/" class="external-link uri">https://mc-stan.org/cmdstanr/</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cmdstanr"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://mc-stan.org/r-packages/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can then install the development version of <strong>coevolve</strong> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ScottClaessens/coevolve"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-use-coevolve">How to use coevolve<a class="anchor" aria-label="anchor" href="#how-to-use-coevolve"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ScottClaessens/coevolve" class="external-link">coevolve</a></span><span class="op">)</span></span></code></pre></div>
<p>As an example, we analyse the coevolution of political and religious authority in 97 Austronesian societies. These data were compiled and analysed in <a href="https://www.nature.com/articles/s41562-022-01471-y" class="external-link">Sheehan et al. (2023)</a>. Both variables are four-level ordinal variables reflecting increasing levels of authority. We use a phylogeny of Austronesian languages to assess patterns of coevolution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/coev_fit.html">coev_fit</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">authority</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      political_authority <span class="op">=</span> <span class="st">"ordered_logistic"</span>,</span>
<span>      religious_authority <span class="op">=</span> <span class="st">"ordered_logistic"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"language"</span>,</span>
<span>    tree <span class="op">=</span> <span class="va">authority</span><span class="op">$</span><span class="va">phylogeny</span>,</span>
<span>    <span class="co"># manually set prior</span></span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A_offdiag <span class="op">=</span> <span class="st">"normal(0, 2)"</span><span class="op">)</span>,</span>
<span>    <span class="co"># arguments for cmdstanr</span></span>
<span>    parallel_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 441.6 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 582.9 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 621.8 seconds.</span></span>
<span><span class="co">#&gt; Chain 4 finished in 626.9 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 4 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 568.3 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 627.2 seconds.</span></span>
<span><span class="co">#&gt; Warning: 22 of 4000 (1.0%) transitions ended with a divergence.</span></span>
<span><span class="co">#&gt; See https://mc-stan.org/misc/warnings for details.</span></span></code></pre></div>
<p>The results can be investigated using:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variables: political_authority = ordered_logistic </span></span>
<span><span class="co">#&gt;            religious_authority = ordered_logistic </span></span>
<span><span class="co">#&gt;      Data: authority$data (Number of observations: 97)</span></span>
<span><span class="co">#&gt; Phylogeny: authority$phylogeny (Number of trees: 1)</span></span>
<span><span class="co">#&gt;     Draws: 4 chains, each with iter = 1000; warmup = 1000; thin = 1</span></span>
<span><span class="co">#&gt;            total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Autoregressive selection effects:</span></span>
<span><span class="co">#&gt;                     Estimate Est.Error  2.5% 97.5% Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; political_authority    -0.67      0.53 -1.99 -0.03 1.00     2120     1768</span></span>
<span><span class="co">#&gt; religious_authority    -0.78      0.59 -2.20 -0.03 1.00     2260     1766</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cross selection effects:</span></span>
<span><span class="co">#&gt;                                           Estimate Est.Error  2.5% 97.5% Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; political_authority ⟶ religious_authority     2.32      1.03  0.38  4.45 1.00     1567     1971</span></span>
<span><span class="co">#&gt; religious_authority ⟶ political_authority     1.82      1.11 -0.28  4.07 1.00     1288     2124</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Drift parameters:</span></span>
<span><span class="co">#&gt;                                              Estimate Est.Error  2.5% 97.5% Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sd(political_authority)                          1.95      0.83  0.27  3.50 1.01      801     1193</span></span>
<span><span class="co">#&gt; sd(religious_authority)                          1.29      0.80  0.06  2.94 1.00      761     1327</span></span>
<span><span class="co">#&gt; cor(political_authority,religious_authority)     0.26      0.32 -0.44  0.78 1.00     2732     2641</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Continuous time intercept parameters:</span></span>
<span><span class="co">#&gt;                     Estimate Est.Error  2.5% 97.5% Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; political_authority     0.21      0.95 -1.56  2.09 1.00     4088     1162</span></span>
<span><span class="co">#&gt; religious_authority     0.21      0.94 -1.65  2.06 1.00     5112     2655</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ordinal cutpoint parameters:</span></span>
<span><span class="co">#&gt;                        Estimate Est.Error  2.5% 97.5% Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; political_authority[1]    -1.31      0.91 -3.12  0.51 1.00     2736     2683</span></span>
<span><span class="co">#&gt; political_authority[2]    -0.56      0.89 -2.32  1.24 1.00     3129     2891</span></span>
<span><span class="co">#&gt; political_authority[3]     1.64      0.92 -0.10  3.55 1.00     3268     2956</span></span>
<span><span class="co">#&gt; religious_authority[1]    -1.53      0.92 -3.31  0.24 1.00     3019     3066</span></span>
<span><span class="co">#&gt; religious_authority[2]    -0.84      0.90 -2.59  0.94 1.00     3329     3051</span></span>
<span><span class="co">#&gt; religious_authority[3]     1.60      0.95 -0.17  3.51 1.00     3205     3102</span></span>
<span><span class="co">#&gt; Warning: There were 22 divergent transitions after warmup.</span></span>
<span><span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span></code></pre></div>
<p>The summary provides general information about the model and details on the posterior draws for the model parameters. In particular, the output shows the autoregressive selection effects (i.e., the effect of a variable on itself in the future), the cross selection effects (i.e., the effect of a variable on another variable in the future), the amount of drift, continuous time intercept parameters for the stochastic differential equation, and cutpoints for the ordinal variables.</p>
<p>While this summary output is useful as a first glance, it is difficult to interpret these parameters directly to infer directions of coevolution. Another approach is to “intervene” in the system. We can hold variables of interest at their average values and then increase one variable by a standardised amount to see how this affects the optimal trait value for another variable.</p>
<p>The <code><a href="reference/coev_plot_delta_theta.html">coev_plot_delta_theta()</a></code> function allows us to visualise <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>θ</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">\Delta\theta_{z}</annotation></semantics></math> for all variable pairs in the model. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>θ</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">\Delta\theta_{z}</annotation></semantics></math> is defined as the change in the optimal trait value of one variable which results from a one median absolute deviation increase in another variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/coev_plot_delta_theta.html">coev_plot_delta_theta</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 235 rows containing non-finite outside the scale range (`stat_density()`).</span></span></code></pre></div>
<p><img src="reference/figures/README-authority-delta-theta-1.png" alt="Plot showing the posterior distributions of delta theta for both directions of coevolution between political and religious authority. The bulk of the posterior densities are greater than zero." width="60%" style="display: block; margin: auto;"></p>
<p>This plot suggests that both variables influence one another in their coevolution. A standardised increase in political authority results in an increase in the optimal trait value for religious authority, and vice versa. In other words, these two variables reciprocally coevolve over evolutionary time.</p>
</div>
<div class="section level2">
<h2 id="citing-coevolve">Citing coevolve<a class="anchor" aria-label="anchor" href="#citing-coevolve"></a>
</h2>
<p>When using the <strong>coevolve</strong> package, please cite the following papers:</p>
<ul>
<li>Ringen, E., Martin, J. S., &amp; Jaeggi, A. (2021). Novel phylogenetic methods reveal that resource-use intensification drives the evolution of “complex” societies. <em>EcoEvoRXiv</em>. <a href="https://doi.org/10.32942/osf.io/wfp95" class="external-link uri">https://doi.org/10.32942/osf.io/wfp95</a>
</li>
<li>Sheehan, O., Watts, J., Gray, R. D., Bulbulia, J., Claessens, S., Ringen, E. J., &amp; Atkinson, Q. D. (2023). Coevolution of religious and political authority in Austronesian societies. <em>Nature Human Behaviour</em>, <em>7</em>(1), 38-45. <a href="https://doi.org/10.1038/s41562-022-01471-y" class="external-link uri">https://doi.org/10.1038/s41562-022-01471-y</a>
</li>
</ul>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ScottClaessens/coevolve/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ScottClaessens/coevolve/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing coevolve</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Scott Claessens <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3562-6981" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Erik Ringen <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ScottClaessens/coevolve/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/ScottClaessens/coevolve/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Scott Claessens, Erik Ringen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
