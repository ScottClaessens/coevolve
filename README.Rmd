---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# coevolve

<!-- badges: start -->
<!-- badges: end -->

## Overview

The **coevolve** package allows the user to fit Bayesian dynamic coevolutionary models in Stan.

## Installation

To use the **coevolve** package, you must first install the `cmdstanr` package (see full installation instructions here: https://mc-stan.org/cmdstanr/).

```r
install.packages("cmdstanr", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
```

You can then install the development version of `coevolve` with:

```r
# install.packages("devtools")
devtools::install_github("ScottClaessens/coevolve")
```

## Example

We can simulate a phylogenetic tree with some data to see how the package works. First, simulate a phylogenetic tree.

```{r}
# set the random seed
set.seed(1)
# number of taxa
n <- 50
# random tree
tree <- ape::rtree(n)
```

Then, simulate data for two binary traits. We allow these traits to evolve independently on the tree, but they do not influence one another in their evolution. In other words, they do not coevolve.

```{r}
# simulate data
d <- 
  data.frame(
    # id to match dataset to tree tips
    id = tree$tip.label,
    # simulate binary variables (0/1 integers)
    # that evolve independently on the tree
    x = as.integer(ape::rTraitDisc(tree)) - 1L,
    y = as.integer(ape::rTraitDisc(tree)) - 1L
  )

head(d)
```

We can then fit our Bayesian dynamic coevolutionary model in `cmdstanr` with the `coev_fit()` function. We declare both variables and set the response distribution `bernoulli_logit`.

```{r}
# load the coevolve package
library(coevolve)

# fit model
m <-
  coev_fit(
    data = d,
    variables = list(
      x = "bernoulli_logit",
      y = "bernoulli_logit"
    ),
    id = "id",
    tree = tree,
    # additional arguments for cmdstanr
    parallel_chains = 4,
    refresh = 0,
    show_messages = FALSE,
    seed = 1
  )

summary(m)
```

From the cross selection effects, we correctly infer that the two traits do not influence one another in their evolution.

We can also plot the cross selection effects from this model using the `coev_plot_cross()` function.

```{r}
coev_plot_cross(m)
```

## Citing coevolve

When using the coevolve package, please cite the following papers:

- Ringen, E., Martin, J. S., & Jaeggi, A. (2021). Novel phylogenetic methods reveal that resource-use intensification drives the evolution of "complex" societies. _EcoEvoRXiv_. https://doi.org/10.32942/osf.io/wfp95
- Sheehan, O., Watts, J., Gray, R. D., Bulbulia, J., Claessens, S., Ringen, E. J., & Atkinson, Q. D. (2023). Coevolution of religious and political authority in Austronesian societies. _Nature Human Behaviour_, _7_(1), 38-45. https://doi.org/10.1038/s41562-022-01471-y
